CodeMirror.defineExtension("autoFormatRange",function(a,b){function k(){h+="\n",j=!0,++i}for(var c=this,d=c.getMode(),e=c.getRange(a,b).split("\n"),f=CodeMirror.copyState(d,c.getTokenAt(a).state),g=c.getOption("tabSize"),h="",i=0,j=0==a.ch,l=0;l<e.length;++l){for(var m=new CodeMirror.StringStream(e[l],g);!m.eol();){var n=CodeMirror.innerMode(d,f),o=d.token(m,f),p=m.current();m.start=m.pos,j&&!/\S/.test(p)||(h+=p,j=!1),!j&&n.mode.newlineAfterToken&&n.mode.newlineAfterToken(o,p,m.string.slice(m.pos)||e[l+1]||"",n.state)&&k()}!m.pos&&d.blankLine&&d.blankLine(f),j||k()}c.operation(function(){c.replaceRange(h,a,b);for(var d=a.line+1,e=a.line+i;d<=e;++d)c.indentLine(d,"smart")})}),CodeMirror.defineExtension("autoIndentRange",function(a,b){var c=this;this.operation(function(){for(var d=a.line;d<=b.line;d++)c.indentLine(d,"smart")})});